<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style type="text/css">
  body{
    margin: 0;
    padding: 0;
  }
.pubu{
    position: absolute;
    width: 1100px;
    left: 50%;
    margin-left: -550px;
}
.box{
    padding:20px 0 0 20px;
    float: left;
}
.box img{
    width: 200px;
    height: auto;
    opacity: 0;
}
  </style>
</head>
<body>
  <div id="app">
    <div class="pubu">
    </div>
  </div>
<!-- import Vue before Element -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js" integrity="sha256-kXTEJcRFN330VirZFl6gj9+UM6gIKW195fYZeR3xDhc=" crossorigin="anonymous"></script>
<!-- import JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/element-ui@2.15.3/lib/index.js" integrity="sha256-OFVFYfqhQ9nDnKh+NfIsefpy/fnjTwkK909ZYgo45nw=" crossorigin="anonymous"></script>
<script>
  var app=new Vue({
      el: '#app',
      data: {
        Number:0,
        showLogoutButton:false,
        tableData: [],
        dialogFormVisible: false,
        password:'123456'
      },
      mounted () {
      //check if the user is logged in
      //read the basic auth credientials from the browser
      var requestOptions = {
        method: 'GET',
        redirect: 'follow',
        //include authorization credientials
        credentials: 'include'
      };
      fetch("./api/manage/check", requestOptions)
        .then(response => response.text())
        .then(result => {console.log(result);
          if(result=="true"){
            this.showLogoutButton=true;
          }else if(result=="Not using basic auth."){
            
          }
          else{
            window.location.href="./api/manage/login";
          }
        })
        .catch(error =>  {alert("An error occurred while synchronizing data with the server, please check the network connection");console.log('error', error)});

      Array.prototype.remove = function(from, to) {
        var rest = this.slice((to || from) + 1 || this.length);
        this.length = from < 0 ? this.length + from : from;
        return this.push.apply(this, rest);
      };
      var requestOptions = {
  method: 'GET',
  redirect: 'follow',
  //include authorization credientials
  credentials: 'include'
  
};
fetch("./api/manage/list", requestOptions)
  //判断是否需要登录
  .then(response => {
    if(response.status==401){
      alert("请先登录");
      window.location.href="./api/manage/login";
    }
    else{
      return response;
    }
  })
  .then(response => response.text()) 
  .then(result => {
    imgList =JSON.parse(result);
    var targetElement = document.querySelector('.pubu');
    //console.log(result)
    let str ='';
    for (let i = 0; i < tableData.length; i++){
      if(tableData[i].name.indexOf(".mp4")>0)continue;
      str += '<img data-original='+"https://image.gincode.icu/file/"+tableData[i].name+' src='+"https://image.gincode.icu/file/"+tableData[i].name +'>';
    }
    targetElement.innerHTML = str
  })
  .catch(error => {alert("An error occurred while synchronizing data with the server, please check the network connection");console.log('error', error)});
    }
    })
    
</script>
<script>
  (function(h,o,t,j,a,r){
      h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
      h._hjSettings={hjid:2531461,hjsv:6};
      a=o.getElementsByTagName('head')[0];
      r=o.createElement('script');r.async=1;
      r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
      a.appendChild(r);
  })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<script type="text/javascript">
(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "7t5ai7agat");
</script>
</body>
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script>
    $(function () {
        // 获取图片的宽度(200px)
        let imgWidth = $('img').outerWidth(); // 200

        waterfallHandler();

        // 瀑布流处理
        function waterfallHandler() {
            // 获取图片的列数
            let column = parseInt($(window).width() / imgWidth);

            // 高度数组
            let heightArr = [];
            for(let i=0; i<column; i++) {
                heightArr[i] = 0;
            }

            // 遍历所有图片进行定位处理
            $.each($('img'), function (index, item) {
                // 当前元素的高度
                let itemHeight = $(item).outerHeight();
                // 高度数组最小的高度
                let minHeight = Math.min(...heightArr);
                // 高度数组最小的高度的索引
                let minIndex = heightArr.indexOf(minHeight);

                $(item).css({
                    position: 'absolute',
                    top: minHeight + 'px',
                    left: minIndex * imgWidth + 'px'
                });

                heightArr[minIndex] += itemHeight;
            });
        }

        // 窗口大小改变
        $(window).resize(function () {
            waterfallHandler();
        });
    });
</script>
</html>